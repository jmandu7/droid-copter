<html>
	<head>
		<title>QuadCopter WebServer</title>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.5.0/jquery.min.js"></script>
		<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.10/jquery-ui.min.js"></script>
		<link type="text/css" href="css/ui-lightness/jquery-ui-1.8.10.custom.css" rel="stylesheet" media="screen">
		<script type="text/javascript" language="JavaScript">
			var saveImage = false;
			var stopPosts;
			var unique = '';
			var host = window.location;
			var armed = false;
			
			$(document).ready(function(){
				$('#inputSave').click(function() {
					saveImage = true;
				});
				
				$('#inputSubmitIP').click(function() {
					host = 'http://' + $('#customIP').val() + ':8080/';
				});
				
				$('#testPost').click(function() {
					stopPosts = false;
					refreshInfo();
				});
				
				$('#stopPost').click(function() {
					stopPosts = true;
				});
				
				$('#submitArmDisarm').toggle(function() {
					$(this).val('Disarm');
					armed = true;
					sendControls();					
				},
				function() {
					$(this).val('Arm');
					armed = false;
				});
				
				setupControls('Roll');
				setupControls('Pitch');
				setupControls('Yaw');
				
				$('#divThrottleSlider').slider({
					orientation: 'vertical',
					value:0,
					min: 0,
					max: 1000,
					step: 50,
					slide: function(event, ui) {
						$('#inputThrottleValue').val(ui.value);
						$('#holdThrottleValue').val(ui.value + 1000);
					}
				});
				$('#inputThrottleValue').val($('#divThrottleSlider').slider('value'));
				$('#holdThrottleValue').val($('#divThrottleSlider').slider('value') + 1000);
				
				$('#submitHoldInputs').click(function() {
					$('#divControls div').each(function() {
						$(this).next().val($(this).slider('value') + 1000);
					});
				});
				
				$('#submitResetInputs').click(function() {
					$('#divControls div').each(function() {
						$(this).slider('value', 500);
						$(this).prev().val(500);
						$(this).next().val($(this).slider('value') + 1000);
					});
				});
				
				$('input:submit, a').button();
				
				$('#inputSubmitPost').click(function() {
					var dateSent = new Date();
					$.post(host + 'EchoServlet', {PostText: $('#inputPost').val()},
					function(response){
						alert(response);
					})
					.error(function(){
						alert('error');
					})
				});

				refreshImage();
			});
			
			function sendControls()
			{
				$.post(host + 'EchoServlet', {Roll: $('#holdRollValue').val(), 
				Pitch: $('#holdPitchValue').val(), Yaw: $('#holdYawValue').val(),
				Throttle: $('#holdThrottleValue').val()})
				if(armed)
				{
					var q = setTimeout('sendControls()', 1000);
				}
			};
			
			function refreshImage()
			{
				if(saveImage)
				{
					$('body').append('<br>' + unique + '<br><div style="width: 480; height: 640; margin-top: 150px; margin-left: -50px"><img style="-webkit-transform: rotate(+90deg); -moz-transform: rotate(+90deg);" src="' + host + 'webcam.jpg?time=' + unique.getTime() + '"></div>');
					saveImage = false;
				}
			
				unique = new Date();
				$('#imgDynamic').attr('src', host + 'webcam.jpg?time=' + unique.getTime());
				var t = setTimeout('refreshImage()', 1000);
			};
			
			function refreshInfo()
			{
				var sent = new Date();
				$.post(host + 'EchoServlet', {PostText: $('#inputPost').val()})
				.success(function(){
					$('#recordedTimes').append('<td style="border: inset 1px;">' + (new Date() - sent) + '</td>');
					if(!stopPosts)
						var s = setTimeout('refreshInfo()', $('#querySeconds').val()*1000);					
				});				
								
				var count = 0;
				var total = 0;
				$('td').each(function() {
					count += parseInt($(this).html());
					total++;
				});
				var avg = count/total;
				
				$('#averageTime').html('Average Response Time: ' + avg);
			};
			
			function setupControls(controlName)
			{
				$('#div' + controlName + 'Slider').slider({
					value:500,
					min: 0,
					max: 1000,
					step: 100,
					slide: function(event, ui) {
						$('#input' +  controlName +  'Value').val(ui.value);
					}
				});
				$('#input' +  controlName + 'Value').val($('#div' + controlName + 'Slider').slider('value'));
				$('#hold' +  controlName + 'Value').val($('#div' + controlName + 'Slider').slider('value') + 1000);
			};
			
		</script>
	</head>
	<body>
		Custom IP:<input id="customIP" type="text"></input><input id="inputSubmitIP" type="submit" value="Use Custom IP"></input>
		<br>
		Post Data:<input id="inputPost" type="text" value="string"></input><input id="inputSubmitPost" type="submit" value="Post Test Data"></input>
		<br>
		Frequency (seconds):<input id="querySeconds" type="text" value="1"></input><input id="testPost" type="submit" value="Start Test"></input><input id="stopPost" type="submit" value="Stop Test">
		<br><br>
		<div id="averageTime"></div>
		<br>
		<table id="recordedTimes" style="border: solid 1px;"></table>
		<br>
		<input id="submitArmDisarm" type="submit" value="Arm">
		CONTROLS:
		<div id="divControls" style="width: 400px; margin: 15px;">
			Roll:
			<input type="text" id="inputRollValue"/>
			<div id="divRollSlider"></div>
			Sending:
			<input type="text" id="holdRollValue"/>
			<br>
			<br>
			Pitch:
			<input type="text" id="inputPitchValue"/>
			<div id="divPitchSlider"></div>
			Sending:
			<input type="text" id="holdPitchValue"/>
			<br>
			<br>
			Yaw:
			<input type="text" id="inputYawValue"/>
			<div id="divYawSlider"></div>
			Sending:
			<input type="text" id="holdYawValue"/>
			<br>
			<input id="submitHoldInputs" type="submit" value="Hold">
			<input id="submitResetInputs" type="submit" value="Reset">
		</div>
		<br>
		<div id="divThrottleSlider"></div>
		Throttle: <input type="text" id="inputThrottleValue"/> Sending : <input type="text" id="holdThrottleValue"/>
		<br>	
		<br>
		<br>
		<div>
			<input id="inputSave" style="font-size: 36px;" type="button" value="Save Frame"/>
		</div>
		<div style="width: 480; height: 640; margin-top: 150px; margin-left: -50px;">
			<img id="imgDynamic" style="-webkit-transform: rotate(+90deg); -moz-transform: rotate(+90deg);" src="webcam.jpg">
		</div>
	</body>
</html>
